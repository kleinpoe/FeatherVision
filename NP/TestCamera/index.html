<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">
<title></title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
body{
margin:0;
padding:0;
background-color:#303030;
}

#streamStage{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
}

#streamStage:before {
content: '';
box-sizing: border-box;
position: absolute;
top: 50%;
left: 50%;
width: 2rem;
height: 2rem;
margin-top: -1rem;
margin-left: -1rem;
}

#stream{
max-height: 100%;
max-width: 100%;
margin: auto;
position: absolute;
top: 0; left: 0; bottom: 0; right: 0;
}
</style>
<script src="/jmuxer.min.js"></script>
</head>
<body>
	<div id="streamtage">
		 <video controls autoplay muted id="stream"></video>	
	</div>
<body>
    <script>
	window.onload = function(){	
		var jmuxer = new JMuxer({
			node: 'stream',
			mode: 'video',
			flushingTime: 0,
			fps: $fps,
			debug: false
		 });

		var ws = new WebSocket("ws://$ip:$port/ws/");
		ws.binaryType = 'arraybuffer';
		ws.addEventListener('message',
		function(event)
		{
			if (!document.hidden)
			{
				var isKeyframe = new Uint8Array(event.data,0,1)[0] > 0;
				var timestampBytes = new Uint8Array(event.data,1,8);
				var frameData = new Uint8Array(event.data,9);
				jmuxer.feed({video: frameData});	
				//var response = "Received isKeyFrame:" + isKeyframe + " " + timestampBytes[0] + timestampBytes[1] + timestampBytes[2] + timestampBytes[3] + timestampBytes[4] + timestampBytes[5] + timestampBytes[6] + timestampBytes[7] ;
				ws.send( timestampBytes );
				//console.log("Received frame with " + isKeyframe);
			}
			
		});
	}     
    </script>
</body>
</html>